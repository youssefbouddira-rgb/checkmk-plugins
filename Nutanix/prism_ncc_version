#!/usr/bin/env python3
# Copyright (C) 2023 Checkmk GmbH - License: GNU General Public License v2
# Developed by Youssef BOUDDIRA <youssefbouddira@gmail.com>
# Checkmk Plugin â€“ Nutanix NCC Version Check

from collections.abc import Mapping
from typing import Any

from .agent_based_api.v1 import register, Result, Service, State
from .agent_based_api.v1.type_defs import CheckResult, DiscoveryResult

Section = Mapping[str, Any]

def discovery_prism_ncc_version(section: Section) -> DiscoveryResult:
    if section:
        yield Service()

def check_prism_ncc_version(params: Mapping[str, Any], section: Section) -> CheckResult:
    if not section:
        return

    ncc_version = section.get("ncc_version", "unknown")

    if ncc_version == "unknown":
        yield Result(state=State.UNKNOWN, summary="NCC version is unknown")
    else:
        yield Result(state=State.OK, summary=f"NCC version: {ncc_version}")

register.check_plugin(
    name="prism_ncc_version",
    service_name="SYS_NTNX_PRISM_NCC_Version",
    sections=["prism_info"],
    check_default_parameters={},
    discovery_function=discovery_prism_ncc_version,
    check_function=check_prism_ncc_version,
    check_ruleset_name="prism_ncc_version",
)
